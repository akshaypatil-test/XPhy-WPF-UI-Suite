<Window x:Class="x_phy_wpf_ui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:shell="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:controls="clr-namespace:x_phy_wpf_ui.Controls"
        Title="X-PHY Deepfake Detector" Height="783" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResize"
        MinHeight="700"
        MinWidth="1000"
        SizeToContent="Manual">
    <WindowChrome.WindowChrome>
    <shell:WindowChrome
        CaptionHeight="0"
        ResizeBorderThickness="6"
        GlassFrameThickness="0"
        UseAeroCaptionButtons="False"/>
</WindowChrome.WindowChrome>

    <!-- Resources removed - now using centralized design system from App.xaml -->
    <!-- All colors and styles are theme-aware via DynamicResource -->

    <Border Background="{DynamicResource Brush.Background}"
            CornerRadius="12"
            ClipToBounds="True">
        <Grid>
        <!-- Auth view (Login/Signup) - shown when not logged in. Background image only here, not in App. -->
        <controls:AuthHostView x:Name="AuthPanel"
                               Visibility="Visible"
                               CloseRequested="AuthHostView_CloseRequested"/>
        
        <!-- App view (Dashboard) - shown when logged in -->
        <Grid x:Name="AppPanel" Background="{DynamicResource Brush.Background}" Visibility="Collapsed">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Top Header with Logo and Window Controls -->
        <Grid Grid.Row="0" Margin="16,15,16,10" Height="32">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Logo -->
            <Image x:Name="LogoImage"
                   Grid.Column="0" 
                   Source="/x-phy.png" 
                   Width="57" 
                   Height="32" 
                   Stretch="Uniform"
                   VerticalAlignment="Center"/>
            
            <!-- Window Controls -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="ðŸ—•" Width="16" Height="16" 
                        Background="Transparent"
                        Foreground="{DynamicResource Brush.TextPrimary}"
                        BorderThickness="0"
                        Click="Minimize_Click"
                        Cursor="Hand"
                        Margin="0,0,4,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" Padding="2">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2A2A2A"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Content="âœ•" Width="16" Height="16" 
                        Background="Transparent"
                        Foreground="{DynamicResource Brush.TextPrimary}"
                        BorderThickness="0"
                        Click="Close_Click"
                        Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" Padding="2">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource Brush.Danger}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>
        
        <!-- Top Navigation Bar -->
        <Grid Grid.Row="1" Margin="0,10,0,10" Height="64">
            <controls:TopNavigationBar x:Name="TopNavBar"
                                       SelectedPage="Home"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       NavigationClicked="TopNavBar_NavigationClicked"
                                       AddCorpUserClicked="TopNavBar_AddCorpUserClicked"/>
        </Grid>
        
        <!-- Statistics Cards -->
        <Grid x:Name="StatisticsCardsGrid" Grid.Row="2" Margin="30,0,30,0" Height="58">
            <controls:StatisticsCards x:Name="StatisticsCardsControl"
                                     TotalDetections="0"
                                     TotalDeepfakes="0"
                                     TotalAnalysisTime="0h"
                                     LastDetection="Never"
                                     VerticalAlignment="Center"/>
        </Grid>
        
        <!-- Main Content Area (no scroll - content fits or clips) -->
        <Grid Grid.Row="3" Margin="30,16,30,15">
            <!-- Detection Content (default) -->
            <Grid x:Name="DetectionContentGrid" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*" MinHeight="280"/>
                </Grid.RowDefinitions>
                
                <!-- Start Deepfake Detection Card -->
                <controls:StartDetectionCard Grid.Row="0"
                                                 x:Name="StartDetectionCard"
                                                 Margin="0,-20,0,20"
                                                 StartDetectionClicked="StartDetectionCard_StartDetectionClicked"/>
                
                <!-- Main content row: either selection or results (same * row so results get full height) -->
                <Grid Grid.Row="1" Margin="0,0,0,12">
                    <!-- Detection Selection (shown when Start Detection is clicked) -->
                    <Grid x:Name="DetectionSelectionContainer"
                          Visibility="Collapsed">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>
                        <controls:DeepfakeDetectionVisualization Grid.Column="0" x:Name="DetectionVisualization"/>
                        <controls:DetectionSelection Grid.Column="2"
                                                     x:Name="DetectionSelectionComponent"
                                                     StartDetectionRequested="DetectionSelection_StartDetectionRequested"
                                                     CancelRequested="DetectionSelection_CancelRequested"/>
                    </Grid>
                    <!-- Detection Results (shown during detection) - same row so it gets full height -->
                    <Grid x:Name="DetectionResultsPanel" Visibility="Collapsed">
                        <controls:DetectionResultsComponent x:Name="DetectionResultsComponent"
                                                            HorizontalAlignment="Stretch"
                                                            VerticalAlignment="Stretch"
                                                            StopDetectionClicked="StopDetection_Click"
                                                            BackToHomeClicked="BackToHome_Click"
                                                            DeepfakeDetected="DetectionResultsComponent_DeepfakeDetected"/>
                    </Grid>
                </Grid>
            </Grid>
            
            <!-- Detection Results Screen (Results tab) -->
            <controls:DetectionResultsScreen x:Name="DetectionResultsScreen"
                                             Visibility="Collapsed"/>

            <!-- Plans Component -->
            <controls:PlansComponent x:Name="PlansComponent"
                                     Visibility="Collapsed"
                                     PlanSelected="PlansComponent_PlanSelected"
                                     BackRequested="PlansComponent_BackRequested"/>

            <!-- Support Component -->
            <controls:SupportComponent x:Name="SupportComponent"
                                       Visibility="Collapsed"
                                       BackRequested="SupportComponent_BackRequested"/>

            <!-- Profile Component -->
            <controls:ProfileComponent x:Name="ProfileComponent"
                                       Visibility="Collapsed"
                                       BackRequested="ProfileComponent_BackRequested"
                                       ChangePasswordRequested="ProfileComponent_ChangePasswordRequested"/>

            <!-- Settings Component -->
            <controls:SettingsComponent x:Name="SettingsComponent"
                                        Visibility="Collapsed"/>

            <!-- Add Corp User (Admin only) -->
            <controls:CreateCorpAccountComponent x:Name="CorpRegisterComponent"
                                                 Visibility="Collapsed"
                                                 BackRequested="CorpRegisterComponent_BackRequested"
                                                 CorpAccountCreated="CorpRegisterComponent_CorpAccountCreated"/>
            
            <!-- Stripe Payment Component Container -->
            <ContentControl x:Name="StripePaymentComponentContainer"
                            Visibility="Collapsed"/>
        </Grid>
        
        <!-- Footer / Bottom Bar -->
        <Grid Grid.Row="4" Margin="30,0,30,16" Height="60">
            <controls:BottomBar x:Name="BottomBar"
                               Status="Trial"
                               RemainingDays="30"
                               ShowSubscribeButton="True"
                               SubscribeClicked="BottomBar_SubscribeClicked"
                               SupportClicked="BottomBar_SupportClicked"
                               LogoutClicked="BottomBar_LogoutClicked"/>
        </Grid>
        </Grid>

        <!-- Change Password overlay: teal tint, glass dialog -->
        <Grid x:Name="ChangePasswordOverlay" Visibility="Collapsed" Background="#801AB4CC" IsHitTestVisible="True">
            <Border HorizontalAlignment="Center" VerticalAlignment="Center" MinWidth="420" MaxWidth="480"
                    Background="#E0101010" BorderBrush="{DynamicResource Brush.Secondary}"
                    BorderThickness="1" CornerRadius="12" Padding="32,28">
                <ContentControl x:Name="ChangePasswordOverlayContent"/>
            </Border>
        </Grid>
        </Grid>
    </Border>
</Window>
