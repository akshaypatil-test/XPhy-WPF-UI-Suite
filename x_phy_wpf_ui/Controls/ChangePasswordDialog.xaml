<UserControl x:Class="x_phy_wpf_ui.Controls.ChangePasswordDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="480" d:DesignWidth="420"
             FocusVisualStyle="{x:Null}">
    <UserControl.Resources>
        <Style x:Key="BackBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource Brush.SecondaryHover}"/>
            <Setter Property="Foreground" Value="{DynamicResource Brush.White}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Brush.Secondary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Brush.SurfaceHover}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="PinkBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource Brush.Primary}"/>
            <Setter Property="Foreground" Value="{DynamicResource Brush.White}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Brush.PrimaryHover}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="{DynamicResource Brush.Disabled}"/>
                    <Setter Property="Foreground" Value="{DynamicResource Brush.TextSecondary}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <StackPanel>
        <!-- Header: title + Close button -->
        <Grid Margin="0,0,0,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Change Password" FontSize="22" FontWeight="Bold" Foreground="{DynamicResource Brush.TextPrimary}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="Update Your Password For Enhanced Account Security."
                           FontSize="13" Foreground="{DynamicResource Brush.TextSecondary}" TextWrapping="Wrap"
                           HorizontalAlignment="Center" TextAlignment="Center" Margin="0,6,0,0"/>
            </StackPanel>
            <Button Grid.Column="1" x:Name="CloseButton" Width="32" Height="32" Padding="0" Margin="0,-4,0,0"
                    VerticalAlignment="Top" HorizontalAlignment="Right"
                    Background="Transparent" BorderThickness="0" Cursor="Hand" Click="Close_Click"
                    ToolTip="Close">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" Padding="4" CornerRadius="4">
                            <Viewbox Width="18" Height="18">
                                <TextBlock Text="✕" FontSize="16" Foreground="{DynamicResource Brush.TextSecondary}"/>
                            </Viewbox>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Brush.SurfaceHover}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </Grid>

        <TextBlock Text="Current Password" FontSize="12" Foreground="{DynamicResource Brush.TextSecondary}" Margin="0,0,0,6"/>
        <Border x:Name="CurrentBorder" Background="{DynamicResource Brush.InputBackground}" BorderBrush="{DynamicResource Brush.Border}"
                BorderThickness="1" CornerRadius="6" MinHeight="40" Margin="0,0,0,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0">
                    <PasswordBox x:Name="CurrentPasswordBox" PasswordChanged="CurrentPasswordBox_PasswordChanged"
                                 LostFocus="CurrentPassword_LostFocus"
                                 Background="Transparent" Foreground="{DynamicResource Brush.TextPrimary}" BorderThickness="0" Padding="10,8" FontSize="14"/>
                    <TextBox x:Name="CurrentReveal" Visibility="Collapsed" TextChanged="CurrentReveal_TextChanged"
                             LostFocus="CurrentPassword_LostFocus"
                             Background="Transparent" Foreground="{DynamicResource Brush.TextPrimary}" BorderThickness="0" Padding="10,8" FontSize="14"/>
                    <TextBlock x:Name="CurrentPlaceholder" Text="Enter your current password" Foreground="{DynamicResource Brush.TextSecondary}"
                               FontSize="14" Margin="10,8,40,8" VerticalAlignment="Center" IsHitTestVisible="False"/>
                </Grid>
                <Button Grid.Column="1" Width="36" Height="32" VerticalAlignment="Center" Margin="0,0,6,0"
                        Background="Transparent" BorderThickness="0" Cursor="Hand" Click="CurrentEye_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" Padding="6">
                                <Viewbox Width="20" Height="20">
                                    <Grid Width="24" Height="24">
                                        <Path Stroke="{DynamicResource Brush.TextSecondary}" StrokeThickness="1.25" Fill="Transparent" Data="M 12,5.5 C 7,5.5 2.5,9 1,12 2.5,15 7,18.5 12,18.5 17,18.5 21.5,15 23,12 21.5,9 17,5.5 12,5.5 Z"/>
                                        <Ellipse Width="8" Height="8" Stroke="{DynamicResource Brush.TextSecondary}" StrokeThickness="1.25" Fill="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Viewbox>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>
        <TextBlock x:Name="CurrentErrorText" Text="" FontSize="11" Foreground="{DynamicResource Brush.Error}" Margin="4,0,0,4" Visibility="Collapsed" TextWrapping="Wrap"/>

        <!-- New Password: label + Info icon (match Create Account design) -->
        <Grid Margin="0,14,0,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="New Password" FontSize="12" Foreground="{DynamicResource Brush.TextSecondary}" VerticalAlignment="Center"/>
            <Button x:Name="NewPasswordInfoButton" Grid.Column="1"
                    Width="18" Height="18" Margin="6,0,0,0"
                    VerticalAlignment="Center"
                    Background="Transparent" BorderThickness="0"
                    Cursor="Hand" Click="NewPasswordInfoButton_Click"
                    ToolTip="Password requirements">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{DynamicResource Brush.TextSecondary}"
                                BorderThickness="1" CornerRadius="9"
                                Padding="0">
                            <TextBlock Text="i" FontSize="11" FontWeight="SemiBold"
                                       Foreground="{DynamicResource Brush.TextSecondary}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
            <Popup x:Name="NewPasswordRequirementsPopup"
                   PlacementTarget="{Binding ElementName=NewPasswordInfoButton}"
                   Placement="Right" StaysOpen="False"
                   AllowsTransparency="False" PopupAnimation="Fade">
                <Border Background="{DynamicResource Brush.Surface}"
                        BorderBrush="{DynamicResource Brush.Border}"
                        BorderThickness="1" CornerRadius="8"
                        Padding="14,12" Margin="8,0,0,0"
                        MinWidth="220">
                    <StackPanel>
                        <TextBlock Text="Password requirements"
                                   FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Border Width="16" Height="16" CornerRadius="8" Background="{DynamicResource Brush.Success}" Margin="0,0,8,0" VerticalAlignment="Center">
                                <TextBlock Text="✓" FontSize="10" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Minimum 8 characters" FontSize="11" Foreground="{DynamicResource Brush.Success}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Border Width="16" Height="16" CornerRadius="8" Background="{DynamicResource Brush.Success}" Margin="0,0,8,0" VerticalAlignment="Center">
                                <TextBlock Text="✓" FontSize="10" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="One uppercase letter" FontSize="11" Foreground="{DynamicResource Brush.Success}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Border Width="16" Height="16" CornerRadius="8" Background="{DynamicResource Brush.Success}" Margin="0,0,8,0" VerticalAlignment="Center">
                                <TextBlock Text="✓" FontSize="10" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="One number" FontSize="11" Foreground="{DynamicResource Brush.Success}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Border Width="16" Height="16" CornerRadius="8" Background="{DynamicResource Brush.Success}" Margin="0,0,8,0" VerticalAlignment="Center">
                                <TextBlock Text="✓" FontSize="10" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="At least one special character (no spaces)" FontSize="11" Foreground="{DynamicResource Brush.Success}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>
        <Border x:Name="NewBorder" Background="{DynamicResource Brush.InputBackground}" BorderBrush="{DynamicResource Brush.Border}"
                BorderThickness="1" CornerRadius="6" MinHeight="40" Margin="0,0,0,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0">
                    <PasswordBox x:Name="NewPasswordBox" PasswordChanged="NewPasswordBox_PasswordChanged"
                                 LostFocus="NewPassword_LostFocus"
                                 Background="Transparent" Foreground="{DynamicResource Brush.TextPrimary}" BorderThickness="0" Padding="10,8" FontSize="14"/>
                    <TextBox x:Name="NewReveal" Visibility="Collapsed" TextChanged="NewReveal_TextChanged"
                             LostFocus="NewPassword_LostFocus"
                             Background="Transparent" Foreground="{DynamicResource Brush.TextPrimary}" BorderThickness="0" Padding="10,8" FontSize="14"/>
                    <TextBlock x:Name="NewPlaceholder" Text="Create new password" Foreground="{DynamicResource Brush.TextSecondary}"
                               FontSize="14" Margin="10,8,40,8" VerticalAlignment="Center" IsHitTestVisible="False"/>
                </Grid>
                <Button Grid.Column="1" Width="36" Height="32" VerticalAlignment="Center" Margin="0,0,6,0"
                        Background="Transparent" BorderThickness="0" Cursor="Hand" Click="NewEye_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" Padding="6">
                                <Viewbox Width="20" Height="20">
                                    <Grid Width="24" Height="24">
                                        <Path Stroke="{DynamicResource Brush.TextSecondary}" StrokeThickness="1.25" Fill="Transparent" Data="M 12,5.5 C 7,5.5 2.5,9 1,12 2.5,15 7,18.5 12,18.5 17,18.5 21.5,15 23,12 21.5,9 17,5.5 12,5.5 Z"/>
                                        <Ellipse Width="8" Height="8" Stroke="{DynamicResource Brush.TextSecondary}" StrokeThickness="1.25" Fill="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Viewbox>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>
        <TextBlock x:Name="NewErrorText" Text="" FontSize="11" Foreground="{DynamicResource Brush.Error}" Margin="4,0,0,4" Visibility="Collapsed" TextWrapping="Wrap"/>

        <TextBlock Text="Confirm Password" FontSize="12" Foreground="{DynamicResource Brush.TextSecondary}" Margin="0,14,0,6"/>
        <Border x:Name="ConfirmBorder" Background="{DynamicResource Brush.InputBackground}" BorderBrush="{DynamicResource Brush.Border}"
                BorderThickness="1" CornerRadius="6" MinHeight="40" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0">
                    <PasswordBox x:Name="ConfirmPasswordBox" PasswordChanged="ConfirmPasswordBox_PasswordChanged"
                                 LostFocus="ConfirmPassword_LostFocus"
                                 Background="Transparent" Foreground="{DynamicResource Brush.TextPrimary}" BorderThickness="0" Padding="10,8" FontSize="14"/>
                    <TextBox x:Name="ConfirmReveal" Visibility="Collapsed" TextChanged="ConfirmReveal_TextChanged"
                             LostFocus="ConfirmPassword_LostFocus"
                             Background="Transparent" Foreground="{DynamicResource Brush.TextPrimary}" BorderThickness="0" Padding="10,8" FontSize="14"/>
                    <TextBlock x:Name="ConfirmPlaceholder" Text="Confirm your password" Foreground="{DynamicResource Brush.TextSecondary}"
                               FontSize="14" Margin="10,8,40,8" VerticalAlignment="Center" IsHitTestVisible="False"/>
                </Grid>
                <Button Grid.Column="1" Width="36" Height="32" VerticalAlignment="Center" Margin="0,0,6,0"
                        Background="Transparent" BorderThickness="0" Cursor="Hand" Click="ConfirmEye_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" Padding="6">
                                <Viewbox Width="20" Height="20">
                                    <Grid Width="24" Height="24">
                                        <Path Stroke="{DynamicResource Brush.TextSecondary}" StrokeThickness="1.25" Fill="Transparent" Data="M 12,5.5 C 7,5.5 2.5,9 1,12 2.5,15 7,18.5 12,18.5 17,18.5 21.5,15 23,12 21.5,9 17,5.5 12,5.5 Z"/>
                                        <Ellipse Width="8" Height="8" Stroke="{DynamicResource Brush.TextSecondary}" StrokeThickness="1.25" Fill="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Viewbox>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>
        <TextBlock x:Name="ConfirmErrorText" Text="" FontSize="11" Foreground="{DynamicResource Brush.Error}" Margin="4,0,0,4" Visibility="Collapsed" TextWrapping="Wrap"/>

        <TextBlock x:Name="ErrorText" Text="" FontSize="12" Foreground="{DynamicResource Brush.Error}" Margin="0,0,0,12"
                   TextWrapping="Wrap" Visibility="Collapsed"/>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Content="Back" Style="{StaticResource BackBtnStyle}" Click="Back_Click"/>
            <Button Grid.Column="2" x:Name="UpdatePasswordButton" Content="Update Password" Style="{StaticResource PinkBtnStyle}"
                    Click="UpdatePassword_Click" IsEnabled="False"/>
        </Grid>
    </StackPanel>
</UserControl>
